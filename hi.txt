FlowWithCSV.tsx

import React, { useState, useCallback } from 'react';
import ReactFlow, { Controls, Background, Node } from 'reactflow';
import 'reactflow/dist/style.css';
import Papa from 'papaparse';

interface CSVNode {
  node: string;
  type: string;
  name: string;
  value: string;
  graphdepth: number;
  'parent node': string;
}

const FlowWithCSV: React.FC = () => {
  const [nodes, setNodes] = useState<Node[]>([]);
  const [edges, setEdges] = useState([]);

  const handleFileUpload = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0];
    if (file) {
      Papa.parse<CSVNode>(file, {
        header: true,
        complete: (results) => {
          const data = results.data;
          const processedNodes: Node[] = data.map((item) => ({
            id: item.node,
            type: item.type,
            data: { label: item.name, value: item.value, graphdepth: item.graphdepth, parentNode: item['parent node'] },
            position: { x: 0, y: 0 }, // Initial positions, to be calculated
          }));

          const positionedNodes = calculateNodePositions(processedNodes);
          setNodes(positionedNodes);

          // Optionally, set edges if you want to show connections
          setEdges(generateEdges(positionedNodes));
        },
      });
    }
  }, []);

  const calculateNodePositions = (nodes: Node[]) => {
    const nodeMap: { [key: string]: Node } = {};
    const spacingX = 200;
    const spacingY = 100;

    nodes.forEach(node => {
      const parentNode = (node.data as any).parentNode;
      if (parentNode) {
        const parent = nodeMap[parentNode];
        node.position = {
          x: parent.position.x + spacingX,
          y: parent.position.y + (parent.childrenCount || 1) * spacingY,
        };
        parent.childrenCount = (parent.childrenCount || 0) + 1;
      } else {
        node.position = {
          x: 0,
          y: ((node.data as any).graphdepth - 1) * spacingY,
        };
      }
      nodeMap[node.id] = node;
    });

    return nodes;
  };

  const generateEdges = (nodes: Node[]) => {
    const edges = [];
    nodes.forEach(node => {
      const parentNode = (node.data as any).parentNode;
      if (parentNode) {
        edges.push({
          id: `e-${parentNode}-${node.id}`,
          source: parentNode,
          target: node.id,
        });
      }
    });
    return edges;
  };

  return (
    <div style={{ height: '100vh' }}>
      <input type="file" accept=".csv" onChange={handleFileUpload} />
      <ReactFlow nodes={nodes} edges={edges}>
        <Background />
        <Controls />
      </ReactFlow>
    </div>
  );
};

export default FlowWithCSV;









import React from 'react';
import FlowWithCSV from './FlowWithCSV';

const App: React.FC = () => {
  return (
    <div style={{ height: '100vh' }}>
      <FlowWithCSV />
    </div>
  );
}

export default App;










{
  "compilerOptions": {
    "target": "es5",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noFallthroughCasesInSwitch": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["src"]
}











