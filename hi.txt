import networkx as nx
import ipycytoscape
import panel as pn

# Initialize Panel
pn.extension()

# Create a NetworkX graph
G = nx.Graph()
G.add_edges_from([(1, 2), (1, 3), (2, 4), (2, 5), (3, 6), (3, 7)])

# Create an ipycytoscape widget
cyto_graph = ipycytoscape.CytoscapeWidget()

# Convert NetworkX graph to ipycytoscape graph
cyto_graph.graph.add_graph_from_networkx(G)

# Define callback function to handle node clicks
def node_clicked(event):
    clicked_node = event['data']['id']
    # Update the graph or perform any other action
    print(f"Node {clicked_node} clicked")
    # Example of adding a child node
    new_node_id = max(G.nodes) + 1
    G.add_node(new_node_id)
    G.add_edge(clicked_node, new_node_id)
    cyto_graph.graph.clear()
    cyto_graph.graph.add_graph_from_networkx(G)

# Attach the callback to node click event
cyto_graph.on('node', 'click', node_clicked)

# Panel layout
layout = pn.Column(
    "### Click a node to update the graph",
    pn.pane.IPyWidget(cyto_graph)
)

# Serve the app
pn.serve(layout)
